(window.webpackJsonp=window.webpackJsonp||[]).push([[7,3],{242:function(e,t,l){"use strict";l.r(t);var n={props:["visible","title"],data:function(){return{fileList:[]}},mounted:function(){},methods:{upload:function(){this.$emit("upload",this.fileList)},cancel:function(){this.$emit("cancel"),this.fileList=[]},fileChange:function(e,t){this.fileList=t}}},o=l(203),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{withHeader:!1,"append-to-body":!0,"show-close":!1,"lock-scroll":!1,visible:e.visible,width:"100%"}},[t("transition",{attrs:{name:"scale-in",mode:"out-in",appear:""}},[e.visible?t("el-row",{staticClass:"d-flex justify-content-center align-items-center"},[t("el-col",{attrs:{xs:24,sm:20,md:6}},[t("div",{staticClass:"d-flex flex-column rounded-xl shadow overflowxy p-4 bg-light pe-all"},[t("div",{staticClass:"d-flex flex-grow w-100 justify-content-between align-items-center mb-4"},[t("span",{staticClass:"h5 font-weight-bold my-0 text-black"},[e._v(e._s(e.title))]),e._v(" "),t("div",{staticClass:"d-flex flex-grow align-items-center"},[t("Button",{staticClass:"rounded-xl p-2 border cursor-pointer",attrs:{icon:{type:"element",src:"el-icon-close"}},on:{click:e.cancel}})],1)]),e._v(" "),t("div",{staticClass:"d-flex flex-column w-100"},[t("el-upload",{ref:"upload",staticClass:"d-flex w-100",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","auto-upload":!1,"on-change":e.fileChange,"file-list":e.fileList}},[t("Button",{staticClass:"d-flex flex-row w-100 rounded-xl p-2 border",attrs:{slot:"trigger",label:"Добавить",icon:{type:"element",src:"el-icon-plus"}},slot:"trigger"})],1),e._v(" "),t("Button",{staticClass:"d-flex flex-row rounded-xl border px-4 py-3 w-100 justify-content-center bg-success text-white mt-4",attrs:{label:"Загрузить"},on:{click:e.upload}})],1)])])],1):e._e()],1)],1)}),[],!1,null,null,null);t.default=component.exports},459:function(e,t,l){"use strict";l.r(t);l(204);var n=l(40),o=(l(83),l(215),l(57),l(140),l(141),l(205),l(84),l(80),l(143),l(237)),r=l.n(o),c={components:{DialogUpload:l(242).default},props:["building","client"],data:function(){return{dialogUpload:!1,current:{model:null,section:null,floor:null},models:[{name:"sections",label:"Секции",fields:["id","title","levels"]},{name:"floors",label:"Этажи",fields:["id","section","floorNumbers","flats","polygon","images"]},{name:"flats",label:"Планировки",fields:["id","title","section","polygon"]}]}},mounted:function(){this.current.model=this.models[2]},methods:{uploadFloorPlan:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function l(){var o,c,d;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,o=t.building.floors.find((function(e){return e.id===t.current.floor})).images,(c=new FormData).append("model","building"),d=t.client._id+"/buildings/"+t.building._id+"/floors/"+t.current.floor,c.append("dir",d),console.log(d,e),l.next=9,Promise.all(e.map(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t){var l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=r.a.randomBytes(8).toString("hex")+".jpg",c.append("images",t.raw,l),o.push({dir:"https://storage.yandexcloud.net/360m/"+d,filename:l});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return l.next=11,t.$store.dispatch("adm/uploadImages",c);case 11:t.dialogUpload=!1,l.next=17;break;case 14:l.prev=14,l.t0=l.catch(0),console.log(l.t0);case 17:case"end":return l.stop()}}),l,null,[[0,14]])})))()},upload:function(e,t){"cancel"===e&&(this.dialogUpload=!1),"start"===e&&(this.current.floor=t,this.dialogUpload=!0)},remove:function(e){console.log(this.current.model.name,e),this.building[this.current.model.name]=this.building[this.current.model.name].filter((function(i){return i.id!==e}))},removeImage:function(e,image){e.images=e.images.filter((function(i){return i.filename!==image.filename}))},getLevels:function(e){return this.building.isOneSection?this.building.levels:e?Number(this.building.sections.find((function(s){return s.id===e})).levels):0},changeValue:function(e){e.id,e.value;this.models},goMenu:function(e){e.id;var t=e.item;this.current.model=this.models.find((function(e){return e.name===t}))},create:function(){var e={id:r.a.randomBytes(8).toString("hex")};"flats"===this.current.model.name&&(e.title="",e.polygon="",e.square=0,e.rooms=0,this.building.isOneSection||(e.section=null)),"sections"===this.current.model.name&&(e.title="",e.levels=0),"floors"===this.current.model.name&&(this.building.isOneSection||(e.section=null),e.flats=[],e.floorNumbers=[],e.images=[],e.polygon=""),this.building[this.current.model.name].push(e)}},computed:{getLevelNumbers:function(){return null!==this.current.section?this.current.section.levels:this.building.levels}}},d=c,f=l(203),component=Object(f.a)(d,(function(){var e=this,t=e._self._c;return null!==e.current.model?t("div",{staticClass:"d-flex flex-column w-100 pos-relative"},[t("div",{staticClass:"d-flex flex-grow w-100 justify-content-between align-items-center px-4 py-3 bg-white border-bottom fontsize13"},[t("Navmenu",{staticClass:"d-flex flex-row",attrs:{items:e.models,itemValueKey:"name",itemLabelKey:"label",itemClass:"mr-3 font-weight-bold cursor-pointer",itemClassDefault:"text-muted",itemClassActive:"text-dark",active:e.current.model.name,idKey:"navmenuBuilding"},on:{go:e.goMenu}}),e._v(" "),t("Button",{staticClass:"d-flex flex-grow rounded bg-success text-white p-2",attrs:{icon:{type:"element",src:"el-icon-plus"}},on:{click:e.create}})],1),e._v(" "),t("transition",{attrs:{name:"slide-fade-from-bottom"}},[t("div",{staticClass:"d-flex flex-column px-3 py-3 bg-light overflowYscroll",staticStyle:{"max-height":"500px"}},e._l(e.building[e.current.model.name],(function(l){return t("div",{key:l.id,staticClass:"d-flex flex-grow align-items-center justify-content-between border py-1 px-3 mb-2 rounded bg-white"},[t("div",{staticClass:"d-flex flex-grow align-items-center"},e._l(e.current.model.fields,(function(n){return t("div",{key:n,staticClass:"d-flex flex-grow mr-3 py-1"},["id"===n?t("span",{staticStyle:{width:"150px"}},[e._v(e._s(l.id))]):e._e(),e._v(" "),"title"===n?t("el-input",{attrs:{placeholder:"Название"},model:{value:l.title,callback:function(t){e.$set(l,"title",t)},expression:"item.title"}}):e._e(),e._v(" "),"levels"===n?t("el-input",{attrs:{placeholder:"Этажность"},model:{value:l.levels,callback:function(t){e.$set(l,"levels",t)},expression:"item.levels"}}):e._e(),e._v(" "),"polygon"===n?t("el-input",{attrs:{placeholder:"Полигон SVG"},model:{value:l.polygon,callback:function(t){e.$set(l,"polygon",t)},expression:"item.polygon"}}):e._e(),e._v(" "),"section"!==n||e.building.isOneSection?e._e():t("el-select",{model:{value:l.section,callback:function(t){e.$set(l,"section",t)},expression:"item.section"}},e._l(e.building.sections,(function(section){return t("el-option",{key:section.id,attrs:{value:section.id,label:section.title}})})),1),e._v(" "),"floorNumbers"===n&&null!==l.section?t("el-select",{attrs:{multiple:!0,"collapse-tags":!0},model:{value:l.floorNumbers,callback:function(t){e.$set(l,"floorNumbers",t)},expression:"item.floorNumbers"}},e._l(e.getLevels(l.section),(function(e,l){return t("el-option",{key:l,attrs:{value:e,label:e}})})),1):e._e(),e._v(" "),"flats"===n?t("el-select",{attrs:{multiple:!0,"collapse-tags":!0},model:{value:l.flats,callback:function(t){e.$set(l,"flats",t)},expression:"item.flats"}},e._l(e.building.flats,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.title}})})),1):e._e(),e._v(" "),"images"===n?t("div",{staticClass:"d-flex flex-grow"},e._l(l.images,(function(image){return t("el-popover",{key:image.filename,attrs:{placement:"right",width:"400",trigger:"click"}},[e.dialogUpload?e._e():t("div",{staticClass:"d-flex flex-column p-4"},[t("Picture",{attrs:{src:image.dir+"/small/"+image.filename}}),e._v(" "),t("Button",{staticClass:"rounded border text-danger px-3 py-2 mt-4 justify-content-between",attrs:{icon:{type:"element",src:"el-icon-delete"},label:"Удалить изображение"},on:{click:function(t){return e.removeImage(l,image)}}})],1),e._v(" "),t("Button",{staticClass:"rounded border p-2 mr-2",attrs:{slot:"reference",icon:{type:"element",src:"el-icon-picture"}},slot:"reference"})],1)})),1):e._e()],1)})),0),e._v(" "),t("div",{staticClass:"d-flex flex-grow align-items-center"},["floors"===e.current.model.name?t("Button",{staticClass:"rounded border p-2 mr-2",attrs:{icon:{type:"element",src:"el-icon-upload"}},on:{click:function(t){return e.upload("start",l.id)}}}):e._e(),e._v(" "),t("Button",{staticClass:"d-flex rounded p-2 border text-danger",attrs:{icon:{type:"element",src:"el-icon-delete"}},on:{click:function(t){return e.remove(l.id)}}})],1)])})),0)]),e._v(" "),t("DialogUpload",{attrs:{visible:e.dialogUpload,title:"Загрузить план этажа"},on:{upload:e.uploadFloorPlan,cancel:function(t){return e.upload("cancel")}}})],1):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);